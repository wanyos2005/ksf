/*!
 * Fine Uploader
 *
 * Copyright 2013, Widen Enterprises, Inc. info@fineuploader.com
 *
 * Version: 3.7.0
 *
 * Homepage: http://fineuploader.com
 *
 * Repository: git://github.com/Widen/fine-uploader.git
 *
 * Licensed under GNU GPL v3, see LICENSE
 */
var qq=function(b){return{hide:function(){return b.style.display="none",this},attach:function(a,d){return b.addEventListener?b.addEventListener(a,d,!1):b.attachEvent&&b.attachEvent("on"+a,d),function(){qq(b).detach(a,d)}},detach:function(a,d){return b.removeEventListener?b.removeEventListener(a,d,!1):b.attachEvent&&b.detachEvent("on"+a,d),this},contains:function(a){return a?b===a?!0:b.contains?b.contains(a):!!(8&a.compareDocumentPosition(b)):!1},insertBefore:function(a){return a.parentNode.insertBefore(b,a),this},remove:function(){return b.parentNode.removeChild(b),this},css:function(a){return null!=a.opacity&&"string"!=typeof b.style.opacity&&"undefined"!=typeof b.filters&&(a.filter="alpha(opacity="+Math.round(100*a.opacity)+")"),qq.extend(b.style,a),this},hasClass:function(a){var d=new RegExp("(^| )"+a+"( |$)");return d.test(b.className)},addClass:function(a){return qq(b).hasClass(a)||(b.className+=" "+a),this},removeClass:function(a){var d=new RegExp("(^| )"+a+"( |$)");return b.className=b.className.replace(d," ").replace(/^\s+|\s+$/g,""),this},getByClass:function(a){var f,e=[];return b.querySelectorAll?b.querySelectorAll("."+a):(f=b.getElementsByTagName("*"),qq.each(f,function(d,g){qq(g).hasClass(a)&&e.push(g)}),e)},children:function(){for(var a=[],d=b.firstChild;d;){1===d.nodeType&&a.push(d),d=d.nextSibling}return a},setText:function(a){return b.innerText=a,b.textContent=a,this},clearText:function(){return qq(b).setText("")}}};qq.log=function(d,c){window.console&&(c&&"info"!==c?window.console[c]?window.console[c](d):window.console.log("<"+c+"> "+d):window.console.log(d))},qq.isObject=function(b){return b&&!b.nodeType&&"[object Object]"===Object.prototype.toString.call(b)},qq.isFunction=function(b){return"function"==typeof b},qq.isArray=function(b){return"[object Array]"===Object.prototype.toString.call(b)},qq.isString=function(b){return"[object String]"===Object.prototype.toString.call(b)},qq.trimStr=function(b){return String.prototype.trim?b.trim():b.replace(/^\s+|\s+$/g,"")},qq.format=function(e){var d=Array.prototype.slice.call(arguments,1),f=e;return qq.each(d,function(g,c){f=f.replace(/{}/,c)}),f},qq.isFile=function(b){return window.File&&"[object File]"===Object.prototype.toString.call(b)},qq.isFileList=function(b){return window.FileList&&"[object FileList]"===Object.prototype.toString.call(b)},qq.isFileOrInput=function(b){return qq.isFile(b)||qq.isInput(b)},qq.isInput=function(b){return window.HTMLInputElement&&"[object HTMLInputElement]"===Object.prototype.toString.call(b)&&b.type&&"file"===b.type.toLowerCase()?!0:b.tagName&&"input"===b.tagName.toLowerCase()&&b.type&&"file"===b.type.toLowerCase()?!0:!1},qq.isBlob=function(b){return window.Blob&&"[object Blob]"===Object.prototype.toString.call(b)},qq.isXhrUploadSupported=function(){var b=document.createElement("input");return b.type="file",void 0!==b.multiple&&"undefined"!=typeof File&&"undefined"!=typeof FormData&&"undefined"!=typeof(new XMLHttpRequest).upload},qq.isFolderDropSupported=function(b){return b.items&&b.items[0].webkitGetAsEntry},qq.isFileChunkingSupported=function(){return !qq.android()&&qq.isXhrUploadSupported()&&(void 0!==File.prototype.slice||void 0!==File.prototype.webkitSlice||void 0!==File.prototype.mozSlice)},qq.extend=function(e,d,f){return qq.each(d,function(a,c){f&&qq.isObject(c)?(void 0===e[a]&&(e[a]={}),qq.extend(e[a],c,!0)):e[a]=c}),e},qq.indexOf=function(f,e,h){if(f.indexOf){return f.indexOf(e,h)}h=h||0;var g=f.length;for(0>h&&(h+=g);g>h;h+=1){if(f.hasOwnProperty(h)&&f[h]===e){return h}}return -1},qq.getUniqueId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var d=0|16*Math.random(),f="x"==e?d:8|3&d;return f.toString(16)})},qq.ie=function(){return -1!==navigator.userAgent.indexOf("MSIE")},qq.ie10=function(){return -1!==navigator.userAgent.indexOf("MSIE 10")},qq.safari=function(){return void 0!==navigator.vendor&&-1!==navigator.vendor.indexOf("Apple")},qq.chrome=function(){return void 0!==navigator.vendor&&-1!==navigator.vendor.indexOf("Google")},qq.firefox=function(){return -1!==navigator.userAgent.indexOf("Mozilla")&&void 0!==navigator.vendor&&""===navigator.vendor},qq.windows=function(){return"Win32"===navigator.platform},qq.android=function(){return -1!==navigator.userAgent.toLowerCase().indexOf("android")},qq.ios=function(){return -1!==navigator.userAgent.indexOf("iPad")||-1!==navigator.userAgent.indexOf("iPod")||-1!==navigator.userAgent.indexOf("iPhone")},qq.preventDefault=function(b){b.preventDefault?b.preventDefault():b.returnValue=!1},qq.toElement=function(){var b=document.createElement("div");return function(a){b.innerHTML=a;var d=b.firstChild;return b.removeChild(d),d}}(),qq.each=function(f,e){var h,g;if(f){if(qq.isArray(f)){for(h=0;h<f.length&&(g=e(h,f[h]),g!==!1);h++){}}else{for(h in f){if(Object.prototype.hasOwnProperty.call(f,h)&&(g=e(h,f[h]),g===!1)){break}}}}},qq.bind=function(e,d){if(qq.isFunction(e)){var f=Array.prototype.slice.call(arguments,2);return function(){return arguments.length&&(f=f.concat(Array.prototype.slice.call(arguments))),e.apply(d,f)}}throw new Error("first parameter must be a function!")},qq.obj2url=function(j,i,p){var o,n,m=[],l="&",k=function(b,f){var e=i?/\[\]$/.test(i)?i:i+"["+f+"]":f;"undefined"!==e&&"undefined"!==f&&m.push("object"==typeof b?qq.obj2url(b,e,!0):"[object Function]"===Object.prototype.toString.call(b)?encodeURIComponent(e)+"="+encodeURIComponent(b()):encodeURIComponent(e)+"="+encodeURIComponent(b))};if(!p&&i){l=/\?/.test(i)?/\?$/.test(i)?"":"&":"?",m.push(i),m.push(qq.obj2url(j))}else{if("[object Array]"===Object.prototype.toString.call(j)&&"undefined"!=typeof j){for(o=-1,n=j.length;n>o;o+=1){k(j[o],o)}}else{if("undefined"!=typeof j&&null!==j&&"object"==typeof j){for(o in j){j.hasOwnProperty(o)&&k(j[o],o)}}else{m.push(encodeURIComponent(i)+"="+encodeURIComponent(j))}}}return i?m.join(l):m.join(l).replace(/^&/,"").replace(/%20/g,"+")},qq.obj2FormData=function(e,d,f){return d||(d=new FormData),qq.each(e,function(b,c){b=f?f+"["+b+"]":b,qq.isObject(c)?qq.obj2FormData(c,d,b):qq.isFunction(c)?d.append(b,c()):d.append(b,c)}),d},qq.obj2Inputs=function(e,d){var f;return d||(d=document.createElement("form")),qq.obj2FormData(e,{append:function(b,c){f=document.createElement("input"),f.setAttribute("name",b),f.setAttribute("value",c),d.appendChild(f)}}),d},qq.setCookie=function(g,f,j){var i=new Date,h="";j&&(i.setTime(i.getTime()+1000*60*60*24*j),h="; expires="+i.toGMTString()),document.cookie=g+"="+f+h+"; path=/"},qq.getCookie=function(f){var e,h=f+"=",g=document.cookie.split(";");return qq.each(g,function(b,i){for(var c=i;" "==c.charAt(0);){c=c.substring(1,c.length)}return 0===c.indexOf(h)?(e=c.substring(h.length,c.length),!1):void 0}),e},qq.getCookieNames=function(e){var d=document.cookie.split(";"),f=[];return qq.each(d,function(a,g){g=qq.trimStr(g);var c=g.indexOf("=");g.match(e)&&f.push(g.substr(0,c))}),f},qq.deleteCookie=function(b){qq.setCookie(b,"",-1)},qq.areCookiesEnabled=function(){var d=100000*Math.random(),c="qqCookieTest:"+d;return qq.setCookie(c,1),qq.getCookie(c)?(qq.deleteCookie(c),!0):!1},qq.parseJson=function(json){return window.JSON&&qq.isFunction(JSON.parse)?JSON.parse(json):eval("("+json+")")},qq.DisposeSupport=function(){var b=[];return{dispose:function(){var a;do{a=b.shift(),a&&a()}while(a)},attach:function(){var c=arguments;this.addDisposer(qq(c[0]).attach.apply(this,Array.prototype.slice.call(arguments,1)))},addDisposer:function(a){b.push(a)}}},qq.version="3.7.0",qq.supportedFeatures=function(){function F(){var e,d=!0;try{e=document.createElement("input"),e.type="file",qq(e).hide(),e.disabled&&(d=!1)}catch(f){d=!1}return d}function E(){return qq.chrome()&&void 0!==navigator.userAgent.match(/Chrome\/[2][1-9]|Chrome\/[3-9][0-9]/)}function D(){return qq.chrome()&&void 0!==navigator.userAgent.match(/Chrome\/[1][4-9]|Chrome\/[2-9][0-9]/)}function C(){if(window.XMLHttpRequest){var b=new XMLHttpRequest;return void 0!==b.withCredentials}return !1}function B(){return void 0!==window.XDomainRequest}function A(){return C()?!0:B()}var z,y,x,w,v,u,t,s,r,q;return z=F(),y=z&&qq.isXhrUploadSupported(),x=y&&E(),w=y&&qq.isFileChunkingSupported(),v=y&&w&&qq.areCookiesEnabled(),u=y&&D(),t=z&&(void 0!==window.postMessage||y),r=C(),s=B(),q=A(),{uploading:z,ajaxUploading:y,fileDrop:y,folderDrop:x,chunking:w,resume:v,uploadCustomHeaders:y,uploadNonMultipart:y,itemSizeValidation:y,uploadViaPaste:u,progressBar:y,uploadCors:t,deleteFileCorsXhr:r,deleteFileCorsXdr:s,deleteFileCors:q,canDetermineSize:y}}(),qq.Promise=function(){var h,g,l=[],k=[],j=[],i=0;return{then:function(b,a){return 0===i?(b&&l.push(b),a&&k.push(a)):-1===i&&a?a(g):b&&b(h),this},done:function(b){return 0===i?j.push(b):b(),this},success:function(a){return i=1,h=a,l.length&&qq.each(l,function(b,d){d(a)}),j.length&&qq.each(j,function(d,c){c()}),this},failure:function(b){return i=-1,g=b,k.length&&qq.each(k,function(a,d){d(b)}),j.length&&qq.each(j,function(d,c){c()}),this}}},qq.isPromise=function(b){return b&&b.then&&b.done},qq.UploadButton=function(g){function f(){var b=document.createElement("input");return h.multiple&&b.setAttribute("multiple","multiple"),h.acceptFiles&&b.setAttribute("accept",h.acceptFiles),b.setAttribute("type","file"),b.setAttribute("name",h.name),qq(b).css({position:"absolute",right:0,top:0,fontFamily:"Arial",fontSize:"118px",margin:0,padding:0,cursor:"pointer",opacity:0}),h.element.appendChild(b),i.attach(b,"change",function(){h.onChange(b)}),i.attach(b,"mouseover",function(){qq(h.element).addClass(h.hoverClass)}),i.attach(b,"mouseout",function(){qq(h.element).removeClass(h.hoverClass)}),i.attach(b,"focus",function(){qq(h.element).addClass(h.focusClass)}),i.attach(b,"blur",function(){qq(h.element).removeClass(h.focusClass)}),window.attachEvent&&b.setAttribute("tabIndex","-1"),b}var j,i=new qq.DisposeSupport,h={element:null,multiple:!1,acceptFiles:null,name:"qqfile",onChange:function(){},hoverClass:"qq-upload-button-hover",focusClass:"qq-upload-button-focus"};return qq.extend(h,g),qq(h.element).css({position:"relative",overflow:"hidden",direction:"ltr"}),j=f(),{getInput:function(){return j},reset:function(){j.parentNode&&qq(j).remove(),qq(h.element).removeClass(h.focusClass),j=f()}}},qq.PasteSupport=function(h){function g(b){return b.type&&0===b.type.indexOf("image/")}function l(){qq(j.targetElement).attach("paste",function(b){var d=b.clipboardData;d&&qq.each(d.items,function(e,m){if(g(m)){var f=m.getAsFile();j.callbacks.pasteReceived(f)}})})}function k(){i&&i()}var j,i;return j={targetElement:null,callbacks:{log:function(){},pasteReceived:function(){}}},qq.extend(j,h),l(),{reset:function(){k()}}},qq.UploadData=function(r){function q(d){if(qq.isArray(d)){var c=[];return qq.each(d,function(b,e){c.push(m[l[e]])}),c}return m[l[d]]}function p(d){if(qq.isArray(d)){var c=[];return qq.each(d,function(b,e){c.push(m[k[e]])}),c}return m[k[d]]}function o(e){var d=[],f=[].concat(e);return qq.each(f,function(b,h){var g=j[h];void 0!==g&&qq.each(g,function(i,s){d.push(m[s])})}),d}var n,m=[],l={},k={},j={};return n={added:function(a){var s=r.getUuid(a),i=r.getName(a),h=r.getSize(a),g=qq.status.SUBMITTING,f=m.push({id:a,name:i,originalName:i,uuid:s,size:h,status:g})-1;l[a]=f,k[s]=f,void 0===j[g]&&(j[g]=[]),j[g].push(f),r.onStatusChange(a,void 0,g)},retrieve:function(b){return qq.isObject(b)&&m.length?void 0!==b.id?q(b.id):void 0!==b.uuid?p(b.uuid):b.status?o(b.status):void 0:qq.extend([],m,!0)},reset:function(){m=[],l={},k={},j={}},setStatus:function(a,s){var i=l[a],g=m[i].status,f=qq.indexOf(j[g],i);j[g].splice(f,1),m[i].status=s,void 0===j[s]&&(j[s]=[]),j[s].push(i),r.onStatusChange(a,g,s)},uuidChanged:function(f,e){var h=l[f],g=m[h].uuid;m[h].uuid=e,k[e]=h,delete k[g]},nameChanged:function(e,d){var f=l[e];m[f].name=d}}},qq.status={SUBMITTING:"submitting",SUBMITTED:"submitted",REJECTED:"rejected",QUEUED:"queued",CANCELED:"canceled",UPLOADING:"uploading",UPLOAD_RETRYING:"retrying upload",UPLOAD_SUCCESSFUL:"upload successful",UPLOAD_FAILED:"upload failed",DELETE_FAILED:"delete failed",DELETING:"deleting",DELETED:"deleted"},qq.FineUploaderBasic=function(b){this._options={debug:!1,button:null,multiple:!0,maxConnections:3,disableCancelForFormUploads:!1,autoUpload:!0,request:{endpoint:"/server/upload",params:{},paramsInBody:!0,customHeaders:{},forceMultipart:!0,inputName:"qqfile",uuidName:"qquuid",totalFileSizeName:"qqtotalfilesize",filenameParam:"qqfilename"},validation:{allowedExtensions:[],sizeLimit:0,minSizeLimit:0,itemLimit:0,stopOnFirstInvalidFile:!0,acceptFiles:null},callbacks:{onSubmit:function(){},onSubmitted:function(){},onComplete:function(){},onCancel:function(){},onUpload:function(){},onUploadChunk:function(){},onResume:function(){},onProgress:function(){},onError:function(){},onAutoRetry:function(){},onManualRetry:function(){},onValidateBatch:function(){},onValidate:function(){},onSubmitDelete:function(){},onDelete:function(){},onDeleteComplete:function(){},onPasteReceived:function(){},onStatusChange:function(){}},messages:{typeError:"{file} has an invalid extension. Valid extension(s): {extensions}.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",noFilesError:"No files to upload.",tooManyItemsError:"Too many items ({netItems}) would be uploaded.  Item limit is {itemLimit}.",retryFailTooManyItems:"Retry failed - you have reached your file limit.",onLeave:"The files are being uploaded, if you leave now the upload will be cancelled."},retry:{enableAuto:!1,maxAutoAttempts:3,autoAttemptDelay:5,preventRetryResponseProperty:"preventRetry"},classes:{buttonHover:"qq-upload-button-hover",buttonFocus:"qq-upload-button-focus"},chunking:{enabled:!1,partSize:2000000,paramNames:{partIndex:"qqpartindex",partByteOffset:"qqpartbyteoffset",chunkSize:"qqchunksize",totalFileSize:"qqtotalfilesize",totalParts:"qqtotalparts"}},resume:{enabled:!1,id:null,cookiesExpireIn:7,paramNames:{resuming:"qqresume"}},formatFileName:function(c){return void 0!==c&&c.length>33&&(c=c.slice(0,19)+"..."+c.slice(-14)),c},text:{defaultResponseError:"Upload failure reason unknown",sizeSymbols:["kB","MB","GB","TB","PB","EB"]},deleteFile:{enabled:!1,method:"DELETE",endpoint:"/server/upload",customHeaders:{},params:{}},cors:{expected:!1,sendCredentials:!1,allowXdr:!1},blobs:{defaultName:"misc_data"},paste:{targetElement:null,defaultName:"pasted_image"},camera:{ios:!1}},qq.extend(this._options,b,!0),this._handleCameraAccess(),this._wrapCallbacks(),this._disposeSupport=new qq.DisposeSupport,this._filesInProgress=[],this._storedIds=[],this._autoRetries=[],this._retryTimeouts=[],this._preventRetries=[],this._netUploadedOrQueued=0,this._netUploaded=0,this._uploadData=this._createUploadDataTracker(),this._paramsStore=this._createParamsStore("request"),this._deleteFileParamsStore=this._createParamsStore("deleteFile"),this._endpointStore=this._createEndpointStore("request"),this._deleteFileEndpointStore=this._createEndpointStore("deleteFile"),this._handler=this._createUploadHandler(),this._deleteHandler=this._createDeleteHandler(),this._options.button&&(this._button=this._createUploadButton(this._options.button)),this._options.paste.targetElement&&(this._pasteHandler=this._createPasteHandler()),this._preventLeaveInProgress()},qq.FineUploaderBasic.prototype={log:function(d,c){!this._options.debug||c&&"info"!==c?c&&"info"!==c&&qq.log("[FineUploader "+qq.version+"] "+d,c):qq.log("[FineUploader "+qq.version+"] "+d)},setParams:function(d,c){null==c?this._options.request.params=d:this._paramsStore.setParams(d,c)},setDeleteFileParams:function(d,c){null==c?this._options.deleteFile.params=d:this._deleteFileParamsStore.setParams(d,c)},setEndpoint:function(d,c){null==c?this._options.request.endpoint=d:this._endpointStore.setEndpoint(d,c)},getInProgress:function(){return this._filesInProgress.length},getNetUploads:function(){return this._netUploaded},uploadStoredFiles:function(){var b;if(0===this._storedIds.length){this._itemError("noFilesError")}else{for(;this._storedIds.length;){b=this._storedIds.shift(),this._filesInProgress.push(b),this._handler.upload(b)}}},clearStoredFiles:function(){this._storedIds=[]},retry:function(b){return this._onBeforeManualRetry(b)?(this._netUploadedOrQueued++,this._uploadData.setStatus(b,qq.status.UPLOAD_RETRYING),this._handler.retry(b),!0):!1},cancel:function(b){this._handler.cancel(b)},cancelAll:function(){var d=[],c=this;qq.extend(d,this._storedIds),qq.each(d,function(b,e){c.cancel(e)}),this._handler.cancelAll()},reset:function(){this.log("Resetting uploader..."),this._handler.reset(),this._filesInProgress=[],this._storedIds=[],this._autoRetries=[],this._retryTimeouts=[],this._preventRetries=[],this._button.reset(),this._paramsStore.reset(),this._endpointStore.reset(),this._netUploadedOrQueued=0,this._netUploaded=0,this._uploadData.reset(),this._pasteHandler&&this._pasteHandler.reset()},addFiles:function(j,i,p){var o,n,m,l=this,k=[];if(j){for(qq.isFileList(j)||(j=[].concat(j)),o=0;o<j.length;o+=1){if(n=j[o],qq.isFileOrInput(n)){if(qq.isInput(n)&&qq.supportedFeatures.ajaxUploading){for(m=0;m<n.files.length;m++){k.push(n.files[m])}}else{k.push(n)}}else{l.log(n+" is not a File or INPUT element!  Ignoring!","warn")}}this.log("Received "+k.length+" files or inputs."),this._prepareItemsForUpload(k,i,p)}},addBlobs:function(h,g,l){if(h){var k=[].concat(h),j=[],i=this;qq.each(k,function(d,c){qq.isBlob(c)&&!qq.isFileOrInput(c)?j.push({blob:c,name:i._options.blobs.defaultName}):qq.isObject(c)&&c.blob&&c.name?j.push(c):i.log("addBlobs: entry at index "+d+" is not a Blob or a BlobData object","error")}),this._prepareItemsForUpload(j,g,l)}else{this.log("undefined or non-array parameter passed into addBlobs","error")}},getUuid:function(b){return this._handler.getUuid(b)},getResumableFilesData:function(){return this._handler.getResumableFilesData()},getSize:function(b){return this._handler.getSize(b)},getName:function(b){return this._handler.getName(b)},setName:function(d,c){this._handler.setName(d,c),this._uploadData.nameChanged(d,c)},getFile:function(b){return this._handler.getFile(b)},deleteFile:function(b){this._onSubmitDelete(b)},setDeleteFileEndpoint:function(d,c){null==c?this._options.deleteFile.endpoint=d:this._deleteFileEndpointStore.setEndpoint(d,c)},doesExist:function(b){return this._handler.isValid(b)},getUploads:function(b){return this._uploadData.retrieve(b)},_handleCheckedCallback:function(e){var d=this,f=e.callback();return qq.isPromise(f)?(this.log(e.name+" - waiting for "+e.name+" promise to be fulfilled for "+e.identifier),f.then(function(a){d.log(e.name+" promise success for "+e.identifier),e.onSuccess(a)},function(){e.onFailure?(d.log(e.name+" promise failure for "+e.identifier),e.onFailure()):d.log(e.name+" promise failure for "+e.identifier)})):(f!==!1?e.onSuccess(f):e.onFailure?(this.log(e.name+" - return value was 'false' for "+e.identifier+".  Invoking failure callback."),e.onFailure()):this.log(e.name+" - return value was 'false' for "+e.identifier+".  Will not proceed."),f)},_createUploadButton:function(e){var d=this,f=new qq.UploadButton({element:e,multiple:this._options.multiple&&qq.supportedFeatures.ajaxUploading,acceptFiles:this._options.validation.acceptFiles,onChange:function(b){d._onInputChange(b)},hoverClass:this._options.classes.buttonHover,focusClass:this._options.classes.buttonFocus});return this._disposeSupport.addDisposer(function(){f.dispose()}),f},_createUploadHandler:function(){var b=this;return new qq.UploadHandler({debug:this._options.debug,forceMultipart:this._options.request.forceMultipart,maxConnections:this._options.maxConnections,customHeaders:this._options.request.customHeaders,inputName:this._options.request.inputName,uuidParamName:this._options.request.uuidName,filenameParam:this._options.request.filenameParam,totalFileSizeParamName:this._options.request.totalFileSizeName,cors:this._options.cors,demoMode:this._options.demoMode,paramsInBody:this._options.request.paramsInBody,paramsStore:this._paramsStore,endpointStore:this._endpointStore,chunking:this._options.chunking,resume:this._options.resume,blobs:this._options.blobs,log:function(a,d){b.log(a,d)},onProgress:function(a,h,g,f){b._onProgress(a,h,g,f),b._options.callbacks.onProgress(a,h,g,f)},onComplete:function(a,h,g,f){b._onComplete(a,h,g,f),b._options.callbacks.onComplete(a,h,g,f)},onCancel:function(a,d){return b._handleCheckedCallback({name:"onCancel",callback:qq.bind(b._options.callbacks.onCancel,b,a,d),onSuccess:qq.bind(b._onCancel,b,a,d),identifier:a})},onUpload:function(a,d){b._onUpload(a,d),b._options.callbacks.onUpload(a,d)},onUploadChunk:function(a,f,e){b._options.callbacks.onUploadChunk(a,f,e)},onResume:function(a,f,e){return b._options.callbacks.onResume(a,f,e)},onAutoRetry:function(a,h,g,f){return b._preventRetries[a]=g[b._options.retry.preventRetryResponseProperty],b._shouldAutoRetry(a,h,g)?(b._maybeParseAndSendUploadError(a,h,g,f),b._options.callbacks.onAutoRetry(a,h,b._autoRetries[a]+1),b._onBeforeAutoRetry(a,h),b._retryTimeouts[a]=setTimeout(function(){b._onAutoRetry(a,h,g)},1000*b._options.retry.autoAttemptDelay),!0):!1},onUuidChanged:function(a,d){b._uploadData.uuidChanged(a,d)}})},_createDeleteHandler:function(){var b=this;return new qq.DeleteFileAjaxRequestor({method:this._options.deleteFile.method,maxConnections:this._options.maxConnections,uuidParamName:this._options.request.uuidName,customHeaders:this._options.deleteFile.customHeaders,paramsStore:this._deleteFileParamsStore,endpointStore:this._deleteFileEndpointStore,demoMode:this._options.demoMode,cors:this._options.cors,log:function(a,d){b.log(a,d)},onDelete:function(a){b._onDelete(a),b._options.callbacks.onDelete(a)},onDeleteComplete:function(a,f,e){b._onDeleteComplete(a,f,e),b._options.callbacks.onDeleteComplete(a,f,e)}})},_createPasteHandler:function(){var b=this;return new qq.PasteSupport({targetElement:this._options.paste.targetElement,callbacks:{log:function(a,d){b.log(a,d)},pasteReceived:function(a){b._handleCheckedCallback({name:"onPasteReceived",callback:qq.bind(b._options.callbacks.onPasteReceived,b,a),onSuccess:qq.bind(b._handlePasteSuccess,b,a),identifier:"pasted image"})}}})},_createUploadDataTracker:function(){var b=this;return new qq.UploadData({getName:function(a){return b.getName(a)},getUuid:function(a){return b.getUuid(a)},getSize:function(a){return b.getSize(a)},onStatusChange:function(a,f,e){b._onUploadStatusChange(a,f,e),b._options.callbacks.onStatusChange(a,f,e)}})},_onUploadStatusChange:function(){},_handlePasteSuccess:function(f,e){var h=f.type.split("/")[1],g=e;null==g&&(g=this._options.paste.defaultName),g+="."+h,this.addBlobs({name:g,blob:f})},_preventLeaveInProgress:function(){var b=this;this._disposeSupport.attach(window,"beforeunload",function(a){if(b._filesInProgress.length){var a=a||window.event;return a.returnValue=b._options.messages.onLeave,b._options.messages.onLeave}})},_onSubmit:function(b){this._netUploadedOrQueued++,this._options.autoUpload&&this._filesInProgress.push(b)},_onProgress:function(){},_onComplete:function(f,e,h,g){h.success?(this._netUploaded++,this._uploadData.setStatus(f,qq.status.UPLOAD_SUCCESSFUL)):(this._netUploadedOrQueued--,this._uploadData.setStatus(f,qq.status.UPLOAD_FAILED)),this._removeFromFilesInProgress(f),this._maybeParseAndSendUploadError(f,e,h,g)},_onCancel:function(d){this._netUploadedOrQueued--,this._removeFromFilesInProgress(d),clearTimeout(this._retryTimeouts[d]);var c=qq.indexOf(this._storedIds,d);!this._options.autoUpload&&c>=0&&this._storedIds.splice(c,1),this._uploadData.setStatus(d,qq.status.CANCELED)},_isDeletePossible:function(){return this._options.deleteFile.enabled?this._options.cors.expected?qq.supportedFeatures.deleteFileCorsXhr?!0:qq.supportedFeatures.deleteFileCorsXdr&&this._options.cors.allowXdr?!0:!1:!0:!1},_onSubmitDelete:function(d,c){return this._isDeletePossible()?this._handleCheckedCallback({name:"onSubmitDelete",callback:qq.bind(this._options.callbacks.onSubmitDelete,this,d),onSuccess:c||qq.bind(this._deleteHandler.sendDelete,this,d,this.getUuid(d)),identifier:d}):(this.log("Delete request ignored for ID "+d+", delete feature is disabled or request not possible due to CORS on a user agent that does not support pre-flighting.","warn"),!1)},_onDelete:function(b){this._uploadData.setStatus(b,qq.status.DELETING)},_onDeleteComplete:function(f,e,h){var g=this._handler.getName(f);h?(this._uploadData.setStatus(f,qq.status.DELETE_FAILED),this.log("Delete request for '"+g+"' has failed.","error"),void 0===e.withCredentials?this._options.callbacks.onError(f,g,"Delete request failed",e):this._options.callbacks.onError(f,g,"Delete request failed with response code "+e.status,e)):(this._netUploadedOrQueued--,this._netUploaded--,this._handler.expunge(f),this._uploadData.setStatus(f,qq.status.DELETED),this.log("Delete request for '"+g+"' has succeeded."))},_removeFromFilesInProgress:function(d){var c=qq.indexOf(this._filesInProgress,d);c>=0&&this._filesInProgress.splice(c,1)},_onUpload:function(b){this._uploadData.setStatus(b,qq.status.UPLOADING)},_onInputChange:function(b){qq.supportedFeatures.ajaxUploading?this.addFiles(b.files):this.addFiles(b),this._button.reset()},_onBeforeAutoRetry:function(d,c){this.log("Waiting "+this._options.retry.autoAttemptDelay+" seconds before retrying "+c+"...")},_onAutoRetry:function(d,c){this.log("Retrying "+c+"..."),this._autoRetries[d]++,this._uploadData.setStatus(d,qq.status.UPLOAD_RETRYING),this._handler.retry(d)},_shouldAutoRetry:function(b){return !this._preventRetries[b]&&this._options.retry.enableAuto?(void 0===this._autoRetries[b]&&(this._autoRetries[b]=0),this._autoRetries[b]<this._options.retry.maxAutoAttempts):!1},_onBeforeManualRetry:function(e){var d=this._options.validation.itemLimit;if(this._preventRetries[e]){return this.log("Retries are forbidden for id "+e,"warn"),!1}if(this._handler.isValid(e)){var f=this._handler.getName(e);return this._options.callbacks.onManualRetry(e,f)===!1?!1:d>0&&this._netUploadedOrQueued+1>d?(this._itemError("retryFailTooManyItems"),!1):(this.log("Retrying upload for '"+f+"' (id: "+e+")..."),this._filesInProgress.push(e),!0)}return this.log("'"+e+"' is not a valid file ID","error"),!1},_maybeParseAndSendUploadError:function(g,f,j,i){if(!j.success){if(i&&200!==i.status&&!j.error){this._options.callbacks.onError(g,f,"XHR returned response code "+i.status,i)}else{var h=j.error?j.error:this._options.text.defaultResponseError;this._options.callbacks.onError(g,f,h,i)}}},_prepareItemsForUpload:function(f,e,h){var g=this._getValidationDescriptors(f);this._handleCheckedCallback({name:"onValidateBatch",callback:qq.bind(this._options.callbacks.onValidateBatch,this,g),onSuccess:qq.bind(this._onValidateBatchCallbackSuccess,this,g,f,e,h),identifier:"batch validation"})},_upload:function(g,f,j){var i=this._handler.add(g),h=this._handler.getName(i);this._uploadData.added(i),f&&this.setParams(f,i),j&&this.setEndpoint(j,i),this._handleCheckedCallback({name:"onSubmit",callback:qq.bind(this._options.callbacks.onSubmit,this,i,h),onSuccess:qq.bind(this._onSubmitCallbackSuccess,this,i,h),onFailure:qq.bind(this._fileOrBlobRejected,this,i,h),identifier:i})},_onSubmitCallbackSuccess:function(b){this._uploadData.setStatus(b,qq.status.SUBMITTED),this._onSubmit.apply(this,arguments),this._onSubmitted.apply(this,arguments),this._options.callbacks.onSubmitted.apply(this,arguments),this._options.autoUpload?this._handler.upload(b)||this._uploadData.setStatus(b,qq.status.QUEUED):this._storeForLater(b)},_onSubmitted:function(){},_storeForLater:function(b){this._storedIds.push(b)},_onValidateBatchCallbackSuccess:function(i,h,n,m){var l,k=this._options.validation.itemLimit,j=this._netUploadedOrQueued+i.length;0===k||k>=j?h.length>0?this._handleCheckedCallback({name:"onValidate",callback:qq.bind(this._options.callbacks.onValidate,this,h[0]),onSuccess:qq.bind(this._onValidateCallbackSuccess,this,h,0,n,m),onFailure:qq.bind(this._onValidateCallbackFailure,this,h,0,n,m),identifier:"Item '"+h[0].name+"', size: "+h[0].size}):this._itemError("noFilesError"):(l=this._options.messages.tooManyItemsError.replace(/\{netItems\}/g,j).replace(/\{itemLimit\}/g,k),this._batchError(l))},_onValidateCallbackSuccess:function(i,h,n,m){var l=h+1,k=this._getValidationDescriptor(i[h]),j=!1;this._validateFileOrBlobData(i[h],k)&&(j=!0,this._upload(i[h],n,m)),this._maybeProcessNextItemAfterOnValidateCallback(j,i,l,n,m)},_onValidateCallbackFailure:function(g,f,j,i){var h=f+1;this._fileOrBlobRejected(void 0,g[0].name),this._maybeProcessNextItemAfterOnValidateCallback(!1,g,h,j,i)},_maybeProcessNextItemAfterOnValidateCallback:function(h,g,l,k,j){var i=this;g.length>l&&(h||!this._options.validation.stopOnFirstInvalidFile)&&setTimeout(function(){var b=i._getValidationDescriptor(g[l]);i._handleCheckedCallback({name:"onValidate",callback:qq.bind(i._options.callbacks.onValidate,i,g[l]),onSuccess:qq.bind(i._onValidateCallbackSuccess,i,g,l,k,j),onFailure:qq.bind(i._onValidateCallbackFailure,i,g,l,k,j),identifier:"Item '"+b.name+"', size: "+b.size})},0)},_validateFileOrBlobData:function(g,f){var j=f.name,i=f.size,h=!0;return this._options.callbacks.onValidate(f)===!1&&(h=!1),qq.isFileOrInput(g)&&!this._isAllowedExtension(j)?(this._itemError("typeError",j),h=!1):0===i?(this._itemError("emptyError",j),h=!1):i&&this._options.validation.sizeLimit&&i>this._options.validation.sizeLimit?(this._itemError("sizeError",j),h=!1):i&&i<this._options.validation.minSizeLimit&&(this._itemError("minSizeError",j),h=!1),h||this._fileOrBlobRejected(void 0,j),h},_fileOrBlobRejected:function(b){void 0!==b&&this._uploadData.setStatus(b,qq.status.REJECTED)},_itemError:function(r,q){function p(d,c){m=m.replace(d,c)}var o,n,m=this._options.messages[r],l=[],k=[].concat(q),j=k[0];return qq.each(this._options.validation.allowedExtensions,function(d,c){qq.isString(c)&&l.push(c)}),o=l.join(", ").toLowerCase(),p("{file}",this._options.formatFileName(j)),p("{extensions}",o),p("{sizeLimit}",this._formatSize(this._options.validation.sizeLimit)),p("{minSizeLimit}",this._formatSize(this._options.validation.minSizeLimit)),n=m.match(/(\{\w+\})/g),null!==n&&qq.each(n,function(d,c){p(c,k[d])}),this._options.callbacks.onError(null,j,m,void 0),m},_batchError:function(b){this._options.callbacks.onError(null,null,b,void 0)},_isAllowedExtension:function(e){var d=this._options.validation.allowedExtensions,f=!1;return d.length?(qq.each(d,function(a,g){if(qq.isString(g)){var c=new RegExp("\\."+g+"$","i");if(null!=e.match(c)){return f=!0,!1}}}),f):!0},_formatSize:function(d){var c=-1;do{d/=1000,c++}while(d>999);return Math.max(d,0.1).toFixed(1)+this._options.text.sizeSymbols[c]},_wrapCallbacks:function(){var e,d;e=this,d=function(a,i,h){try{return i.apply(e,h)}catch(g){e.log("Caught exception in '"+a+"' callback - "+g.message,"error")}};for(var f in this._options.callbacks){!function(){var b,a;b=f,a=e._options.callbacks[b],e._options.callbacks[b]=function(){return d(b,a,arguments)}}()}},_parseFileOrBlobDataName:function(d){var c;return c=qq.isFileOrInput(d)?d.value?d.value.replace(/.*(\/|\\)/,""):null!==d.fileName&&void 0!==d.fileName?d.fileName:d.name:d.name},_parseFileOrBlobDataSize:function(d){var c;return qq.isFileOrInput(d)?d.value||(c=null!==d.fileSize&&void 0!==d.fileSize?d.fileSize:d.size):c=d.blob.size,c},_getValidationDescriptor:function(f){var e,h,g;return g={},e=this._parseFileOrBlobDataName(f),h=this._parseFileOrBlobDataSize(f),g.name=e,void 0!==h&&(g.size=h),g},_getValidationDescriptors:function(e){var d=this,f=[];return qq.each(e,function(b,c){f.push(d._getValidationDescriptor(c))}),f},_createParamsStore:function(e){var d={},f=this;return{setParams:function(b,h){var g={};qq.extend(g,b),d[h]=g},getParams:function(b){var a={};return null!=b&&d[b]?qq.extend(a,d[b]):qq.extend(a,f._options[e].params),a},remove:function(b){return delete d[b]},reset:function(){d={}}}},_createEndpointStore:function(e){var d={},f=this;return{setEndpoint:function(b,g){d[g]=b},getEndpoint:function(a){return null!=a&&d[a]?d[a]:f._options[e].endpoint},remove:function(b){return delete d[b]},reset:function(){d={}}}},_handleCameraAccess:function(){this._options.camera.ios&&qq.ios()&&(this._options.multiple=!1,null===this._options.validation.acceptFiles?this._options.validation.acceptFiles="image/*;capture=camera":this._options.validation.acceptFiles+=",image/*;capture=camera")}},qq.DragAndDrop=function(v){function u(b){o.callbacks.dropLog("Grabbed "+b.length+" dropped files."),n.dropDisabled(!1),o.callbacks.processingDroppedFilesComplete(b)}function t(f){var c,h,g=new qq.Promise;return f.isFile?f.file(function(b){m.push(b),g.success()},function(a){o.callbacks.dropLog("Problem parsing '"+f.fullPath+"'.  FileError code "+a.code+".","error"),g.failure()}):f.isDirectory&&(c=f.createReader(),c.readEntries(function(e){var d=e.length;for(h=0;h<e.length;h+=1){t(e[h]).done(function(){d-=1,0===d&&g.success()})}e.length||g.success()},function(a){o.callbacks.dropLog("Problem parsing '"+f.fullPath+"'.  FileError code "+a.code+".","error"),g.failure()})),g}function s(h){var c,w,k,j=[],i=new qq.Promise;if(o.callbacks.processingDroppedFiles(),n.dropDisabled(!0),h.files.length>1&&!o.allowMultipleItems){o.callbacks.processingDroppedFilesComplete([]),o.callbacks.dropError("tooManyFilesError",""),n.dropDisabled(!1),i.failure()}else{if(m=[],qq.isFolderDropSupported(h)){for(w=h.items,c=0;c<w.length;c+=1){k=w[c].webkitGetAsEntry(),k&&(k.isFile?m.push(w[c].getAsFile()):j.push(t(k).done(function(){j.pop(),0===j.length&&i.success()})))}}else{m=h.files}0===j.length&&i.success()}return i}function r(b){n=new qq.UploadDropZone({element:b,onEnter:function(a){qq(b).addClass(o.classes.dropActive),a.stopPropagation()},onLeaveNotDescendants:function(){qq(b).removeClass(o.classes.dropActive)},onDrop:function(a){o.hideDropZonesBeforeEnter&&qq(b).hide(),qq(b).removeClass(o.classes.dropActive),s(a.dataTransfer).done(function(){u(m)})}}),l.addDisposer(function(){n.dispose()}),o.hideDropZonesBeforeEnter&&qq(b).hide()}function q(d){var c;return qq.each(d.dataTransfer.types,function(b,e){return"Files"===e?(c=!0,!1):void 0}),c}function p(){var b=o.dropZoneElements;qq.each(b,function(d,c){r(c)}),!b.length||qq.ie()&&!qq.ie10()||l.attach(document,"dragenter",function(a){!n.dropDisabled()&&q(a)&&qq.each(b,function(d,c){qq(c).css({display:"block"})})}),l.attach(document,"dragleave",function(a){o.hideDropZonesBeforeEnter&&qq.FineUploader.prototype._leaving_document_out(a)&&qq.each(b,function(d,c){qq(c).hide()})}),l.attach(document,"drop",function(a){o.hideDropZonesBeforeEnter&&qq.each(b,function(d,c){qq(c).hide()}),a.preventDefault()})}var o,n,m=[],l=new qq.DisposeSupport;return o={dropZoneElements:[],hideDropZonesBeforeEnter:!1,allowMultipleItems:!0,classes:{dropActive:null},callbacks:new qq.DragAndDrop.callbacks},qq.extend(o,v,!0),p(),{setupExtraDropzone:function(b){o.dropZoneElements.push(b),r(b)},removeDropzone:function(e){var d,f=o.dropZoneElements;for(d in f){if(f[d]===e){return f.splice(d,1)}}},dispose:function(){l.dispose(),n.dispose()}}},qq.DragAndDrop.callbacks=function(){return{processingDroppedFiles:function(){},processingDroppedFilesComplete:function(){},dropError:function(d,c){qq.log("Drag & drop error code '"+d+" with these specifics: '"+c+"'","error")},dropLog:function(d,c){qq.log(d,c)}}},qq.UploadDropZone=function(v){function u(){return qq.safari()||qq.firefox()&&qq.windows()}function t(){m||(u?l.attach(document,"dragover",function(b){b.preventDefault()}):l.attach(document,"dragover",function(b){b.dataTransfer&&(b.dataTransfer.dropEffect="none",b.preventDefault())}),m=!0)}function s(f){if(qq.ie()&&!qq.ie10()){return !1}var e,h=f.dataTransfer,g=qq.safari();return e=qq.ie10()?!0:"none"!==h.effectAllowed,h&&e&&(h.files||!g&&h.types.contains&&h.types.contains("Files"))}function r(b){return void 0!==b&&(n=b),n}function q(){l.attach(o,"dragover",function(d){if(s(d)){var c=qq.ie()?null:d.dataTransfer.effectAllowed;d.dataTransfer.dropEffect="move"===c||"linkMove"===c?"move":"copy",d.stopPropagation(),d.preventDefault()}}),l.attach(o,"dragenter",function(b){if(!r()){if(!s(b)){return}p.onEnter(b)}}),l.attach(o,"dragleave",function(d){if(s(d)){p.onLeave(d);var c=document.elementFromPoint(d.clientX,d.clientY);qq(this).contains(c)||p.onLeaveNotDescendants(d)}}),l.attach(o,"drop",function(b){if(!r()){if(!s(b)){return}b.preventDefault(),p.onDrop(b)}})}var p,o,n,m,l=new qq.DisposeSupport;return p={element:null,onEnter:function(){},onLeave:function(){},onLeaveNotDescendants:function(){},onDrop:function(){}},qq.extend(p,v),o=p.element,t(),q(),{dropDisabled:function(b){return r(b)},dispose:function(){l.dispose()}}},qq.FineUploader=function(b){qq.FineUploaderBasic.apply(this,arguments),qq.extend(this._options,{element:null,listElement:null,dragAndDrop:{extraDropzones:[],hideDropzones:!0,disableDefaultDropzone:!1},text:{uploadButton:"Upload a file",cancelButton:"Cancel",retryButton:"Retry",deleteButton:"Delete",failUpload:"Upload failed",dragZone:"Drop files here to upload",dropProcessing:"Processing dropped files...",formatProgress:"{percent}% of {total_size}",waitingForResponse:"Processing..."},template:'<div class="qq-uploader">'+(this._options.dragAndDrop&&this._options.dragAndDrop.disableDefaultDropzone?"":'<div class="qq-upload-drop-area"><span>{dragZoneText}</span></div>')+(this._options.button?"":'<div class="qq-upload-button"><div>{uploadButtonText}</div></div>')+'<span class="qq-drop-processing"><span>{dropProcessingText}</span><span class="qq-drop-processing-spinner"></span></span>'+(this._options.listElement?"":'<ul class="qq-upload-list"></ul>')+"</div>",fileTemplate:'<li><div class="qq-progress-bar"></div><span class="qq-upload-spinner"></span><span class="qq-upload-finished"></span>'+(this._options.editFilename&&this._options.editFilename.enabled?'<span class="qq-edit-filename-icon"></span>':"")+'<span class="qq-upload-file"></span>'+(this._options.editFilename&&this._options.editFilename.enabled?'<input class="qq-edit-filename" tabindex="0" type="text">':"")+'<span class="qq-upload-size"></span><a class="qq-upload-cancel" href="#">{cancelButtonText}</a><a class="qq-upload-retry" href="#">{retryButtonText}</a><a class="qq-upload-delete" href="#">{deleteButtonText}</a><span class="qq-upload-status-text">{statusText}</span></li>',classes:{button:"qq-upload-button",drop:"qq-upload-drop-area",dropActive:"qq-upload-drop-area-active",list:"qq-upload-list",progressBar:"qq-progress-bar",file:"qq-upload-file",spinner:"qq-upload-spinner",finished:"qq-upload-finished",retrying:"qq-upload-retrying",retryable:"qq-upload-retryable",size:"qq-upload-size",cancel:"qq-upload-cancel",deleteButton:"qq-upload-delete",retry:"qq-upload-retry",statusText:"qq-upload-status-text",editFilenameInput:"qq-edit-filename",success:"qq-upload-success",fail:"qq-upload-fail",successIcon:null,failIcon:null,editNameIcon:"qq-edit-filename-icon",editable:"qq-editable",dropProcessing:"qq-drop-processing",dropProcessingSpinner:"qq-drop-processing-spinner"},failedUploadTextDisplay:{mode:"default",maxChars:50,responseProperty:"error",enableTooltip:!0},messages:{tooManyFilesError:"You may only drop one file",unsupportedBrowser:"Unrecoverable error - this browser does not permit file uploading of any kind."},retry:{showAutoRetryNote:!0,autoRetryNote:"Retrying {retryNum}/{maxAuto}...",showButton:!1},deleteFile:{forceConfirm:!1,confirmMessage:"Are you sure you want to delete {filename}?",deletingStatusText:"Deleting...",deletingFailedText:"Delete failed"},display:{fileSizeOnSubmit:!1,prependFiles:!1},paste:{promptForName:!1,namePromptMessage:"Please name this image"},editFilename:{enabled:!1},showMessage:function(c){setTimeout(function(){window.alert(c)},0)},showConfirm:function(e,d,f){setTimeout(function(){var a=window.confirm(e);a?d():f&&f()},0)},showPrompt:function(f,e){var h=new qq.Promise,g=window.prompt(f,e);return null!=g&&qq.trimStr(g).length>0?h.success(g):h.failure("Undefined or invalid user-supplied value."),h}},!0),qq.extend(this._options,b,!0),!qq.supportedFeatures.uploading||this._options.cors.expected&&!qq.supportedFeatures.uploadCors?this._options.element.innerHTML="<div>"+this._options.messages.unsupportedBrowser+"</div>":(this._wrapCallbacks(),this._options.template=this._options.template.replace(/\{dragZoneText\}/g,this._options.text.dragZone),this._options.template=this._options.template.replace(/\{uploadButtonText\}/g,this._options.text.uploadButton),this._options.template=this._options.template.replace(/\{dropProcessingText\}/g,this._options.text.dropProcessing),this._options.fileTemplate=this._options.fileTemplate.replace(/\{cancelButtonText\}/g,this._options.text.cancelButton),this._options.fileTemplate=this._options.fileTemplate.replace(/\{retryButtonText\}/g,this._options.text.retryButton),this._options.fileTemplate=this._options.fileTemplate.replace(/\{deleteButtonText\}/g,this._options.text.deleteButton),this._options.fileTemplate=this._options.fileTemplate.replace(/\{statusText\}/g,""),this._element=this._options.element,this._element.innerHTML=this._options.template,this._listElement=this._options.listElement||this._find(this._element,"list"),this._classes=this._options.classes,this._button||(this._button=this._createUploadButton(this._find(this._element,"button"))),this._deleteRetryOrCancelClickHandler=this._bindDeleteRetryOrCancelClickEvent(),this._focusinEventSupported=!qq.firefox(),this._isEditFilenameEnabled()&&(this._filenameClickHandler=this._bindFilenameClickEvent(),this._filenameInputFocusInHandler=this._bindFilenameInputFocusInEvent(),this._filenameInputFocusHandler=this._bindFilenameInputFocusEvent()),this._dnd=this._setupDragAndDrop(),this._options.paste.targetElement&&this._options.paste.promptForName&&this._setupPastePrompt(),this._totalFilesInBatch=0,this._filesInBatchAddedToUi=0)},qq.extend(qq.FineUploader.prototype,qq.FineUploaderBasic.prototype),qq.extend(qq.FineUploader.prototype,{clearStoredFiles:function(){qq.FineUploaderBasic.prototype.clearStoredFiles.apply(this,arguments),this._listElement.innerHTML=""},addExtraDropzone:function(b){this._dnd.setupExtraDropzone(b)},removeExtraDropzone:function(b){return this._dnd.removeDropzone(b)},getItemByFileId:function(d){for(var c=this._listElement.firstChild;c;){if(c.qqFileId==d){return c}c=c.nextSibling}},reset:function(){qq.FineUploaderBasic.prototype.reset.apply(this,arguments),this._element.innerHTML=this._options.template,this._listElement=this._options.listElement||this._find(this._element,"list"),this._options.button||(this._button=this._createUploadButton(this._find(this._element,"button"))),this._dnd.dispose(),this._dnd=this._setupDragAndDrop(),this._totalFilesInBatch=0,this._filesInBatchAddedToUi=0},_removeFileItem:function(d){var c=this.getItemByFileId(d);qq(c).remove()},_setupDragAndDrop:function(){var f,e=this,h=this._find(this._element,"dropProcessing"),g=this._options.dragAndDrop.extraDropzones;return f=function(b){b.preventDefault()},this._options.dragAndDrop.disableDefaultDropzone||g.push(this._find(this._options.element,"drop")),new qq.DragAndDrop({dropZoneElements:g,hideDropZonesBeforeEnter:this._options.dragAndDrop.hideDropzones,allowMultipleItems:this._options.multiple,classes:{dropActive:this._options.classes.dropActive},callbacks:{processingDroppedFiles:function(){var a=e._button.getInput();qq(h).css({display:"block"}),qq(a).attach("click",f)},processingDroppedFilesComplete:function(b){var a=e._button.getInput();qq(h).hide(),qq(a).detach("click",f),b&&e.addFiles(b)},dropError:function(b,d){e._itemError(b,d)},dropLog:function(b,d){e.log(b,d)}}})},_bindDeleteRetryOrCancelClickEvent:function(){var b=this;return new qq.DeleteRetryOrCancelClickHandler({listElement:this._listElement,classes:this._classes,log:function(a,d){b.log(a,d)},onDeleteFile:function(a){b.deleteFile(a)},onCancel:function(a){b.cancel(a)},onRetry:function(a){var d=b.getItemByFileId(a);qq(d).removeClass(b._classes.retryable),b.retry(a)},onGetName:function(a){return b.getName(a)}})},_isEditFilenameEnabled:function(){return this._options.editFilename.enabled&&!this._options.autoUpload},_filenameEditHandler:function(){var b=this;return{listElement:this._listElement,classes:this._classes,log:function(a,d){b.log(a,d)},onGetUploadStatus:function(a){return b.getUploads({id:a}).status},onGetName:function(a){return b.getName(a)},onSetName:function(a,j){var i=b.getItemByFileId(a),h=qq(b._find(i,"file")),g=b._options.formatFileName(j);h.setText(g),b.setName(a,j)},onGetInput:function(a){return b._find(a,"editFilenameInput")},onEditingStatusChange:function(a,n){var m=b.getItemByFileId(a),l=qq(b._find(m,"editFilenameInput")),k=qq(b._find(m,"file")),j=qq(b._find(m,"editNameIcon")),i=b._classes.editable;n?(l.addClass("qq-editing"),k.hide(),j.removeClass(i)):(l.removeClass("qq-editing"),k.css({display:""}),j.addClass(i)),qq(m).addClass("qq-temp").removeClass("qq-temp")}}},_onUploadStatusChange:function(i,h,n){if(this._isEditFilenameEnabled()){var m,l,k=this.getItemByFileId(i),j=this._classes.editable;k&&n!==qq.status.SUBMITTED&&(m=qq(this._find(k,"file")),l=qq(this._find(k,"editNameIcon")),m.removeClass(j),l.removeClass(j))}},_bindFilenameInputFocusInEvent:function(){var b=qq.extend({},this._filenameEditHandler());return new qq.FilenameInputFocusInHandler(b)},_bindFilenameInputFocusEvent:function(){var b=qq.extend({},this._filenameEditHandler());return new qq.FilenameInputFocusHandler(b)},_bindFilenameClickEvent:function(){var b=qq.extend({},this._filenameEditHandler());return new qq.FilenameClickHandler(b)},_leaving_document_out:function(b){return(qq.chrome()||qq.safari()&&qq.windows())&&0==b.clientX&&0==b.clientY||qq.firefox()&&!b.relatedTarget},_storeForLater:function(d){qq.FineUploaderBasic.prototype._storeForLater.apply(this,arguments);var c=this.getItemByFileId(d);qq(this._find(c,"spinner")).hide()},_find:function(e,d){var f=qq(e).getByClass(this._options.classes[d])[0];if(!f){throw new Error("element not found "+d)}return f},_onSubmit:function(d,c){qq.FineUploaderBasic.prototype._onSubmit.apply(this,arguments),this._addToList(d,c)},_onSubmitted:function(g){if(this._isEditFilenameEnabled()){var f=this.getItemByFileId(g),j=qq(this._find(f,"file")),i=qq(this._find(f,"editNameIcon")),h=this._classes.editable;j.addClass(h),i.addClass(h),this._focusinEventSupported||this._filenameInputFocusHandler.addHandler(this._find(f,"editFilenameInput"))}},_onProgress:function(j,i,p,o){qq.FineUploaderBasic.prototype._onProgress.apply(this,arguments);var n,m,l,k;n=this.getItemByFileId(j),m=this._find(n,"progressBar"),l=Math.round(100*(p/o)),p===o?(k=this._find(n,"cancel"),qq(k).hide(),qq(m).hide(),qq(this._find(n,"statusText")).setText(this._options.text.waitingForResponse),this._displayFileSize(j)):(this._displayFileSize(j,p,o),qq(m).css({display:"block"})),qq(m).css({width:l+"%"})},_onComplete:function(f,e,h){qq.FineUploaderBasic.prototype._onComplete.apply(this,arguments);var g=this.getItemByFileId(f);qq(this._find(g,"statusText")).clearText(),qq(g).removeClass(this._classes.retrying),qq(this._find(g,"progressBar")).hide(),(!this._options.disableCancelForFormUploads||qq.supportedFeatures.ajaxUploading)&&qq(this._find(g,"cancel")).hide(),qq(this._find(g,"spinner")).hide(),h.success?(this._isDeletePossible()&&this._showDeleteLink(f),qq(g).addClass(this._classes.success),this._classes.successIcon&&(this._find(g,"finished").style.display="inline-block",qq(g).addClass(this._classes.successIcon))):(qq(g).addClass(this._classes.fail),this._classes.failIcon&&(this._find(g,"finished").style.display="inline-block",qq(g).addClass(this._classes.failIcon)),this._options.retry.showButton&&!this._preventRetries[f]&&qq(g).addClass(this._classes.retryable),this._controlFailureTextDisplay(g,h))},_onUpload:function(b){qq.FineUploaderBasic.prototype._onUpload.apply(this,arguments),this._showSpinner(b)},_onCancel:function(b){qq.FineUploaderBasic.prototype._onCancel.apply(this,arguments),this._removeFileItem(b)},_onBeforeAutoRetry:function(i){var h,n,m,l,k,j;qq.FineUploaderBasic.prototype._onBeforeAutoRetry.apply(this,arguments),h=this.getItemByFileId(i),n=this._find(h,"progressBar"),this._showCancelLink(h),n.style.width=0,qq(n).hide(),this._options.retry.showAutoRetryNote&&(m=this._find(h,"statusText"),l=this._autoRetries[i]+1,k=this._options.retry.maxAutoAttempts,j=this._options.retry.autoRetryNote.replace(/\{retryNum\}/g,l),j=j.replace(/\{maxAuto\}/g,k),qq(m).setText(j),1===l&&qq(h).addClass(this._classes.retrying))},_onBeforeManualRetry:function(d){var c=this.getItemByFileId(d);return qq.FineUploaderBasic.prototype._onBeforeManualRetry.apply(this,arguments)?(this._find(c,"progressBar").style.width=0,qq(c).removeClass(this._classes.fail),qq(this._find(c,"statusText")).clearText(),this._showSpinner(d),this._showCancelLink(c),!0):(qq(c).addClass(this._classes.retryable),!1)},_onSubmitDelete:function(d){var c=qq.bind(this._onSubmitDeleteSuccess,this,d);qq.FineUploaderBasic.prototype._onSubmitDelete.call(this,d,c)},_onSubmitDeleteSuccess:function(b){this._options.deleteFile.forceConfirm?this._showDeleteConfirm(b):this._sendDeleteRequest(b)},_onDeleteComplete:function(h,g,l){qq.FineUploaderBasic.prototype._onDeleteComplete.apply(this,arguments);var k=this.getItemByFileId(h),j=this._find(k,"spinner"),i=this._find(k,"statusText");qq(j).hide(),l?(qq(i).setText(this._options.deleteFile.deletingFailedText),this._showDeleteLink(h)):this._removeFileItem(h)},_sendDeleteRequest:function(f){var e=this.getItemByFileId(f),h=this._find(e,"deleteButton"),g=this._find(e,"statusText");qq(h).hide(),this._showSpinner(f),qq(g).setText(this._options.deleteFile.deletingStatusText),this._deleteHandler.sendDelete(f,this.getUuid(f))},_showDeleteConfirm:function(f){var e=this._handler.getName(f),h=this._options.deleteFile.confirmMessage.replace(/\{filename\}/g,e),g=(this.getUuid(f),this);this._options.showConfirm(h,function(){g._sendDeleteRequest(f)})},_addToList:function(g,f){var j=qq.toElement(this._options.fileTemplate);if(this._options.disableCancelForFormUploads&&!qq.supportedFeatures.ajaxUploading){var i=this._find(j,"cancel");qq(i).remove()}j.qqFileId=g;var h=this._find(j,"file");qq(h).setText(this._options.formatFileName(f)),qq(this._find(j,"size")).hide(),this._options.multiple||(this._handler.cancelAll(),this._clearList()),this._options.display.prependFiles?this._prependItem(j):this._listElement.appendChild(j),this._filesInBatchAddedToUi+=1,this._options.display.fileSizeOnSubmit&&qq.supportedFeatures.ajaxUploading&&this._displayFileSize(g)},_prependItem:function(e){var d=this._listElement,f=d.firstChild;this._totalFilesInBatch>1&&this._filesInBatchAddedToUi>0&&(f=qq(d).children()[this._filesInBatchAddedToUi-1].nextSibling),d.insertBefore(e,f)},_clearList:function(){this._listElement.innerHTML="",this.clearStoredFiles()},_displayFileSize:function(i,h,n){var m=this.getItemByFileId(i),l=this.getSize(i),k=this._formatSize(l),j=this._find(m,"size");void 0!==h&&void 0!==n&&(k=this._formatProgress(h,n)),qq(j).css({display:"inline"}),qq(j).setText(k)},_formatProgress:function(f,e){function h(d,c){g=g.replace(d,c)}var g=this._options.text.formatProgress;return h("{percent}",Math.round(100*(f/e))),h("{total_size}",this._formatSize(e)),g},_controlFailureTextDisplay:function(i,h){var n,m,l,k,j;n=this._options.failedUploadTextDisplay.mode,m=this._options.failedUploadTextDisplay.maxChars,l=this._options.failedUploadTextDisplay.responseProperty,"custom"===n?(k=h[l],k?k.length>m&&(j=k.substring(0,m)+"..."):(k=this._options.text.failUpload,this.log("'"+l+"' is not a valid property on the server response.","warn")),qq(this._find(i,"statusText")).setText(j||k),this._options.failedUploadTextDisplay.enableTooltip&&this._showTooltip(i,k)):"default"===n?qq(this._find(i,"statusText")).setText(this._options.text.failUpload):"none"!==n&&this.log("failedUploadTextDisplay.mode value of '"+n+"' is not valid","warn")},_showTooltip:function(d,c){d.title=c},_showSpinner:function(e){var d=this.getItemByFileId(e),f=this._find(d,"spinner");f.style.display="inline-block"},_showCancelLink:function(d){if(!this._options.disableCancelForFormUploads||qq.supportedFeatures.ajaxUploading){var c=this._find(d,"cancel");qq(c).css({display:"block"})}},_showDeleteLink:function(e){var d=this.getItemByFileId(e),f=this._find(d,"deleteButton");qq(f).css({display:"block"})},_itemError:function(){var b=qq.FineUploaderBasic.prototype._itemError.apply(this,arguments);this._options.showMessage(b)},_batchError:function(b){qq.FineUploaderBasic.prototype._batchError.apply(this,arguments),this._options.showMessage(b)},_setupPastePrompt:function(){var b=this;this._options.callbacks.onPasteReceived=function(){var a=b._options.paste.namePromptMessage,d=b._options.paste.defaultName;return b._options.showPrompt(a,d)}},_fileOrBlobRejected:function(){this._totalFilesInBatch-=1,qq.FineUploaderBasic.prototype._fileOrBlobRejected.apply(this,arguments)},_prepareItemsForUpload:function(b){this._totalFilesInBatch=b.length,this._filesInBatchAddedToUi=0,qq.FineUploaderBasic.prototype._prepareItemsForUpload.apply(this,arguments)}}),qq.AjaxRequestor=function(R){function Q(){return qq.indexOf(["GET","POST","HEAD"],w.method)>=0}function P(){var b=!1;return qq.each(b,function(a,d){return qq.indexOf(["Accept","Accept-Language","Content-Language","Content-Type"],d)<0?(b=!0,!1):void 0}),b}function O(b){return w.cors.expected&&void 0===b.withCredentials}function N(){var b;return window.XMLHttpRequest&&(b=new XMLHttpRequest,void 0===b.withCredentials&&(b=new XDomainRequest)),b}function M(e,d){var f=x[e].xhr;return f||d||(f=w.cors.expected?N():new XMLHttpRequest,x[e].xhr=f),f}function L(f){var e,h=qq.indexOf(y,f),g=w.maxConnections;delete x[f],y.splice(h,1),y.length>=g&&g>h&&(e=y[g-1],I(e))}function K(f,d){var j=M(f),i=w.method,g=d===!1;L(f),g?A(i+" request for "+f+" has failed","error"):O(j)||B(j.status)||(g=!0,A(i+" request for "+f+" has failed - response code "+j.status,"error")),w.onComplete(f,j,g)}function J(f){var e={},h=x[f].additionalParams,g=w.mandatedParams;return w.paramsStore.getParams&&(e=w.paramsStore.getParams(f)),h&&qq.each(h,function(b,d){e[b]=d}),g&&qq.each(g,function(b,d){e[b]=d}),e}function I(f){var d,j=M(f),i=w.method,h=J(f);w.onSend(f),d=H(f,h),O(j)?(j.onload=F(f),j.onerror=E(f)):j.onreadystatechange=G(f),j.open(i,d,!0),w.cors.expected&&w.cors.sendCredentials&&!O(j)&&(j.withCredentials=!0),D(f),A("Sending "+i+" request for "+f),!z&&h?j.send(qq.obj2url(h,"")):j.send()}function H(f,e){var h=w.endpointStore.getEndpoint(f),g=x[f].addToPath;return void 0!=g&&(h+="/"+g),z&&e?qq.obj2url(e,h):h}function G(b){return function(){4===M(b).readyState&&K(b)}}function F(b){return function(){K(b)}}function E(b){return function(){K(b,!0)}}function D(b){var d=M(b),c=w.customHeaders;O(d)&&(w.cors.expected&&Q()&&!P(c)||(d.setRequestHeader("X-Requested-With","XMLHttpRequest"),d.setRequestHeader("Cache-Control","no-cache"))),"POST"!==w.method&&"PUT"!==w.method||O(d)||d.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),O(d)||qq.each(c,function(f,e){d.setRequestHeader(f,e)})}function C(e){var d=M(e,!0),f=w.method;return d?(O(d)?(d.onerror=null,d.onload=null):d.onreadystatechange=null,d.abort(),L(e),A("Cancelled "+f+" for "+e),w.onCancel(e),!0):!1}function B(b){return qq.indexOf(w.successfulResponseCodes[w.method],b)>=0}var A,z,y=[],x=[],w={method:"POST",maxConnections:3,customHeaders:{},endpointStore:{},paramsStore:{},mandatedParams:{},successfulResponseCodes:{DELETE:[200,202,204],POST:[200,204]},cors:{expected:!1,sendCredentials:!1},log:function(){},onSend:function(){},onComplete:function(){},onCancel:function(){}};return qq.extend(w,R),A=w.log,z="GET"===w.method||"DELETE"===w.method,{send:function(f,e,h){x[f]={addToPath:e,additionalParams:h};var g=y.push(f);g<=w.maxConnections&&I(f)},cancel:function(b){return C(b)}}},qq.DeleteFileAjaxRequestor=function(h){function g(){return i.method.toUpperCase()}function l(){return"POST"===g()?{_method:"DELETE"}:{}}var k,j=["POST","DELETE"],i={method:"DELETE",uuidParamName:"qquuid",endpointStore:{},maxConnections:3,customHeaders:{},paramsStore:{},demoMode:!1,cors:{expected:!1,sendCredentials:!1},log:function(){},onDelete:function(){},onDeleteComplete:function(){}};if(qq.extend(i,h),qq.indexOf(j,g())<0){throw new Error("'"+g()+"' is not a supported method for delete file requests!")}return k=new qq.AjaxRequestor({method:g(),endpointStore:i.endpointStore,paramsStore:i.paramsStore,mandatedParams:l(),maxConnections:i.maxConnections,customHeaders:i.customHeaders,demoMode:i.demoMode,log:i.log,onSend:i.onDelete,onComplete:i.onDeleteComplete,cors:i.cors}),{sendDelete:function(b,f){var d={};i.log("Submitting delete file request for "+b),"DELETE"===g()?k.send(b,f):(d[i.uuidParamName]=f,k.send(b,null,d))}}},qq.WindowReceiveMessage=function(e){var d={log:function(){}},f={};return qq.extend(d,e),{receiveMessage:function(g,c){var h=function(b){c(b.data)};window.postMessage?f[g]=qq(window).attach("message",h):log("iframe message passing not supported in this browser!","error")},stopReceivingMessages:function(g){if(window.postMessage){var c=f[g];c&&c()}}}},qq.UploadHandler=function(j){function i(f){var d,h=qq.indexOf(k,f),g=o.maxConnections;h>=0&&(k.splice(h,1),k.length>=g&&g>h&&(d=k[g-1],m.upload(d)))}function p(b){n("Cancelling "+b),o.paramsStore.remove(b),i(b)}var o,n,m,l,k=[];return o={debug:!1,forceMultipart:!0,paramsInBody:!1,paramsStore:{},endpointStore:{},filenameParam:"qqfilename",cors:{expected:!1,sendCredentials:!1},maxConnections:3,uuidParamName:"qquuid",totalFileSizeParamName:"qqtotalfilesize",chunking:{enabled:!1,partSize:2000000,paramNames:{partIndex:"qqpartindex",partByteOffset:"qqpartbyteoffset",chunkSize:"qqchunksize",totalParts:"qqtotalparts",filename:"qqfilename"}},resume:{enabled:!1,id:null,cookiesExpireIn:7,paramNames:{resuming:"qqresume"}},log:function(){},onProgress:function(){},onComplete:function(){},onCancel:function(){},onUpload:function(){},onUploadChunk:function(){},onAutoRetry:function(){},onResume:function(){},onUuidChanged:function(){}},qq.extend(o,j),n=o.log,m=qq.supportedFeatures.ajaxUploading?new qq.UploadHandlerXhr(o,i,o.onUuidChanged,n):new qq.UploadHandlerForm(o,i,o.onUuidChanged,n),l={add:function(b){return m.add(b)},upload:function(d){var c=k.push(d);return c<=o.maxConnections?(m.upload(d),!0):!1},retry:function(d){var c=qq.indexOf(k,d);return c>=0?m.upload(d,!0):this.upload(d)},cancel:function(d){var c=m.cancel(d);qq.isPromise(c)?c.then(function(){p(d)}):c!==!1&&p(d)},cancelAll:function(){var d=this,c=[];qq.extend(c,k),qq.each(c,function(a,e){d.cancel(e)}),k=[]},getName:function(b){return m.getName(b)},setName:function(d,c){m.setName(d,c)},getSize:function(b){return m.getSize?m.getSize(b):void 0},getFile:function(b){return m.getFile?m.getFile(b):void 0},reset:function(){n("Resetting upload handler"),l.cancelAll(),k=[],m.reset()},expunge:function(b){return m.expunge(b)},getUuid:function(b){return m.getUuid(b)},isValid:function(b){return m.isValid(b)},getResumableFilesData:function(){return m.getResumableFilesData?m.getResumableFilesData():[]}}},qq.UploadHandlerForm=function(Z,Y,X,W){function V(b){void 0!==G[b]&&(G[b](),delete G[b])}function U(f,e){var h=f.id,g=N(h);B[I[g]]=e,G[g]=qq(f).attach("load",function(){J[g]&&(D("Received iframe load event for CORS upload request (iframe name "+h+")"),F[h]=setTimeout(function(){var b="No valid message received from loaded iframe for iframe name "+h;D(b,"error"),e({error:b})},1000))}),C.receiveMessage(h,function(i){D("Received the following window message: '"+i+"'");var c,k=R(N(h),i),j=k.uuid;j&&B[j]?(D("Handling response for iframe name "+h),clearTimeout(F[h]),delete F[h],V(h),c=B[j],delete B[j],C.stopReceivingMessages(h),c(k)):j||D("'"+i+"' does not contain a UUID - ignoring.")})}function T(d,c){K.cors.expected?U(d,c):G[d.id]=qq(d).attach("load",function(){if(D("Received response for "+d.id),d.parentNode){try{if(d.contentDocument&&d.contentDocument.body&&"false"==d.contentDocument.body.innerHTML){return}}catch(a){D("Error when attempting to access iframe during handling of upload response ("+a+")","error")}c()}})}function S(h,g){var l;try{var k=g.contentDocument||g.contentWindow.document,j=k.body.innerHTML;D("converting iframe's innerHTML to JSON"),D("innerHTML = "+j),j&&j.match(/^<pre/i)&&(j=k.body.firstChild.firstChild.nodeValue),l=R(h,j)}catch(i){D("Error when attempting to parse form upload response ("+i+")","error"),l={success:!1}}return l}function R(f,c){var h;try{h=qq.parseJson(c),void 0!==h.newUuid&&(D("Server requested UUID change from '"+I[f]+"' to '"+h.newUuid+"'"),I[f]=h.newUuid,X(f,h.newUuid))}catch(g){D("Error when attempting to parse iframe upload response ("+g+")","error"),h={}}return h}function Q(e){var d=M(e),f=qq.toElement('<iframe src="javascript:false;" name="'+d+'" />');return f.setAttribute("id",d),f.style.display="none",document.body.appendChild(f),f}function P(i,h){var n=K.paramsStore.getParams(i),m=K.demoMode?"GET":"POST",l=qq.toElement('<form method="'+m+'" enctype="multipart/form-data"></form>'),k=K.endpointStore.getEndpoint(i),j=k;return n[K.uuidParamName]=I[i],void 0!==H[i]&&(n[K.filenameParam]=H[i]),K.paramsInBody?qq.obj2Inputs(n,l):j=qq.obj2url(n,k),l.setAttribute("action",j),l.setAttribute("target",h.name),l.style.display="none",document.body.appendChild(l),l}function O(d){delete J[d],delete I[d],delete G[d],K.cors.expected&&(clearTimeout(F[d]),delete F[d],C.stopReceivingMessages(d));var c=document.getElementById(M(d));c&&(c.setAttribute("src","java"+String.fromCharCode(115)+"cript:false;"),qq(c).remove())}function N(b){return b.split("_")[0]}function M(b){return b+"_"+A}var L,K=Z,J=[],I=[],H=[],G={},F={},E=Y,D=W,C=new qq.WindowReceiveMessage({log:D}),B={},A=qq.getUniqueId();return L={add:function(d){d.setAttribute("name",K.inputName);var c=J.push(d)-1;return I[c]=qq.getUniqueId(),d.parentNode&&qq(d).remove(),c},getName:function(b){return void 0!==H[b]?H[b]:L.isValid(b)?J[b].value.replace(/.*(\/|\\)/,""):(D(b+" is not a valid item ID.","error"),void 0)},setName:function(d,c){H[d]=c},isValid:function(b){return void 0!==J[b]},reset:function(){J=[],I=[],H=[],G={},A=qq.getUniqueId()},expunge:function(b){return O(b)},getUuid:function(b){return I[b]},cancel:function(d){var c=K.onCancel(d,L.getName(d));return qq.isPromise(c)?c.then(function(){O(d)}):c!==!1?(O(d),!0):!1},upload:function(g){var e,j=J[g],i=L.getName(g),h=Q(g);if(!j){throw new Error("file with passed id was not added, or already uploaded or cancelled")}K.onUpload(g,L.getName(g)),e=P(g,h),e.appendChild(j),T(h,function(a){D("iframe loaded");var d=a?a:S(g,h);V(g),K.cors.expected||qq(h).remove(),(d.success||!K.onAutoRetry(g,i,d))&&(K.onComplete(g,i,d),E(g))}),D("Sending upload request for "+g),e.submit(),qq(e).remove()}}},qq.UploadHandlerXhr=function(aO,aN,aM,aL){function aK(g,f,j){var i=ad.getSize(g),h=ad.getName(g);f[ac.chunking.paramNames.partIndex]=j.part,f[ac.chunking.paramNames.partByteOffset]=j.start,f[ac.chunking.paramNames.chunkSize]=j.size,f[ac.chunking.paramNames.totalParts]=j.count,f[ac.totalFileSizeParamName]=i,U&&(f[ac.filenameParam]=h)}function aJ(b){b[ac.resume.paramNames.resuming]=!0}function aI(e,d,f){return e.slice?e.slice(d,f):e.mozSlice?e.mozSlice(d,f):e.webkitSlice?e.webkitSlice(d,f):void 0}function aH(i,g){var p=ac.chunking.partSize,o=ad.getSize(i),n=Z[i].file||Z[i].blobData.blob,m=p*g,l=m+p>=o?o:m+p,k=aG(i);return{part:g,start:m,end:l,count:k,blob:aI(n,m,l),size:l-m}}function aG(e){var d=ad.getSize(e),f=ac.chunking.partSize;return Math.ceil(d/f)}function aF(d){var c=new XMLHttpRequest;return Z[d].xhr=c,c}function aE(x,w,v,u){var t=new FormData,s=ac.demoMode?"GET":"POST",r=ac.endpointStore.getEndpoint(u),q=r,p=ad.getName(u),o=ad.getSize(u),n=Z[u].blobData,m=Z[u].newName;return x[ac.uuidParamName]=Z[u].uuid,U&&(x[ac.totalFileSizeParamName]=o,n&&(x[ac.filenameParam]=n.name)),void 0!==m&&(x[ac.filenameParam]=m),ac.paramsInBody||(U||(x[ac.inputName]=m||p),q=qq.obj2url(x,r)),w.open(s,q,!0),ac.cors.expected&&ac.cors.sendCredentials&&(w.withCredentials=!0),U?(ac.paramsInBody&&qq.obj2FormData(x,t),t.append(ac.inputName,v),t):v}function aD(f,e){var h=ac.customHeaders,g=Z[f].file||Z[f].blobData.blob;e.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.setRequestHeader("Cache-Control","no-cache"),U||(e.setRequestHeader("Content-Type","application/octet-stream"),e.setRequestHeader("X-Mime-Type",g.type)),qq.each(h,function(b,d){e.setRequestHeader(b,d)})}function aC(g,f,j){var i=ad.getName(g),h=ad.getSize(g);Z[g].attemptingResume=!1,ac.onProgress(g,i,h,h),ac.onComplete(g,i,f,j),Z[g]&&delete Z[g].xhr,ab(g)}function aB(h){var f,p,l=Z[h].remainingChunkIdxs[0],k=aH(h,l),j=aF(h),e=ad.getSize(h),o=ad.getName(h);void 0===Z[h].loaded&&(Z[h].loaded=0),W&&Z[h].file&&ao(h,k),j.onreadystatechange=ap(h,j),j.upload.onprogress=function(a){if(a.lengthComputable){var g=a.loaded+Z[h].loaded,d=aA(h,l,a.total);ac.onProgress(h,o,g,d)}},ac.onUploadChunk(h,o,aq(k)),p=ac.paramsStore.getParams(h),aK(h,p,k),Z[h].attemptingResume&&aJ(p),f=aE(p,j,k.blob,h),aD(h,j),aa("Sending chunked upload request for item "+h+": bytes "+(k.start+1)+"-"+k.end+" of "+e),j.send(f)}function aA(t,s,r){var q=aH(t,s),p=q.size,o=r-p,n=ad.getSize(t),m=q.count,l=Z[t].initialRequestOverhead,h=o-l;return Z[t].lastRequestOverhead=o,0===s?(Z[t].lastChunkIdxProgress=0,Z[t].initialRequestOverhead=o,Z[t].estTotalRequestsSize=n+m*o):Z[t].lastChunkIdxProgress!==s&&(Z[t].lastChunkIdxProgress=s,Z[t].estTotalRequestsSize+=h),Z[t].estTotalRequestsSize}function az(b){return U?Z[b].lastRequestOverhead:0}function ay(g,f,j){var i=Z[g].remainingChunkIdxs.shift(),h=aH(g,i);Z[g].attemptingResume=!1,Z[g].loaded+=h.size+az(g),Z[g].remainingChunkIdxs.length>0?aB(g):(W&&an(g),aC(g,f,j))}function ax(d,c){return 200!==d.status||!c.success||c.reset}function aw(f,c){var h;try{h=qq.parseJson(c.responseText),void 0!==h.newUuid&&(aa("Server requested UUID change from '"+Z[f].uuid+"' to '"+h.newUuid+"'"),Z[f].uuid=h.newUuid,aM(f,h.newUuid))}catch(g){aa("Error when attempting to parse xhr response text ("+g+")","error"),h={}}return h}function av(b){aa("Server has ordered chunking effort to be restarted on next attempt for item ID "+b,"error"),W&&(an(b),Z[b].attemptingResume=!1),Z[b].remainingChunkIdxs=[],delete Z[b].loaded,delete Z[b].estTotalRequestsSize,delete Z[b].initialRequestOverhead}function au(b){Z[b].attemptingResume=!1,aa("Server has declared that it cannot handle resume for item ID "+b+" - starting from the first chunk","error"),av(b),ad.upload(b,!0)}function at(f,e,h){var g=ad.getName(f);ac.onAutoRetry(f,g,e,h)||aC(f,e,h)}function ar(e,d){var f;Z[e]&&(aa("xhr - server response received for "+e),aa("responseText = "+d.responseText),f=aw(e,d),ax(d,f)?(f.reset&&av(e),Z[e].attemptingResume&&f.reset?au(e):at(e,f,d)):X?ay(e,f,d):aC(e,f,d))}function aq(b){return{partIndex:b.part,startByte:b.start+1,endByte:b.end,totalParts:b.count}}function ap(d,c){return function(){4===c.readyState&&ar(d,c)}}function ao(r,q){var p=ad.getUuid(r),o=Z[r].loaded,n=Z[r].initialRequestOverhead,m=Z[r].estTotalRequestsSize,l=al(r),k=p+Y+q.part+Y+o+Y+n+Y+m,j=ac.resume.cookiesExpireIn;qq.setCookie(l,k,j)}function an(d){if(Z[d].file){var c=al(d);qq.deleteCookie(c)}}function am(r){var q,p,o,n,m,l,k=qq.getCookie(al(r)),j=ad.getName(r);if(k){if(q=k.split(Y),5===q.length){return p=q[0],o=parseInt(q[1],10),n=parseInt(q[2],10),m=parseInt(q[3],10),l=parseInt(q[4],10),{uuid:p,part:o,lastByteSent:n,initialRequestOverhead:m,estTotalRequestsSize:l}}aa("Ignoring previously stored resume/chunk cookie for "+j+" - old cookie format","warn")}}function al(g){var f,j=ad.getName(g),i=ad.getSize(g),h=ac.chunking.partSize;return f="qqfilechunk"+Y+encodeURIComponent(j)+Y+i+Y+h,void 0!==V&&(f+=Y+V),f}function ak(){return null===ac.resume.id||void 0===ac.resume.id||qq.isFunction(ac.resume.id)||qq.isObject(ac.resume.id)?void 0:ac.resume.id}function aj(e,d){var f;for(f=aG(e)-1;f>=d;f-=1){Z[e].remainingChunkIdxs.unshift(f)}aB(e)}function ai(f,e,h,g){h=g.part,Z[f].loaded=g.lastByteSent,Z[f].estTotalRequestsSize=g.estTotalRequestsSize,Z[f].initialRequestOverhead=g.initialRequestOverhead,Z[f].attemptingResume=!0,aa("Resuming "+e+" at partition index "+h),aj(f,h)}function ah(h,g,l){var k,j=ad.getName(h),i=aH(h,g.part);k=ac.onResume(h,j,aq(i)),qq.isPromise(k)?(aa("Waiting for onResume promise to be fulfilled for "+h),k.then(function(){ai(h,j,l,g)},function(){aa("onResume promise fulfilled - failure indicated.  Will not resume."),aj(h,l)})):k!==!1?ai(h,j,l,g):(aa("onResume callback returned false.  Will not resume."),aj(h,l))}function ag(f,e){var h,g=0;Z[f].remainingChunkIdxs&&0!==Z[f].remainingChunkIdxs.length?aB(f):(Z[f].remainingChunkIdxs=[],W&&!e&&Z[f].file?(h=am(f),h?ah(f,h,g):aj(f,g)):aj(f,g))}function af(h){var g,l,k,j=Z[h].file||Z[h].blobData.blob,i=ad.getName(h);Z[h].loaded=0,g=aF(h),g.upload.onprogress=function(a){a.lengthComputable&&(Z[h].loaded=a.loaded,ac.onProgress(h,i,a.loaded,a.total))},g.onreadystatechange=ap(h,g),l=ac.paramsStore.getParams(h),k=aE(l,g,j,h),aD(h,g),aa("Sending upload request for "+h),g.send(k)}function ae(d){var c=Z[d].xhr;c&&(c.onreadystatechange=null,c.abort()),W&&an(d),delete Z[d]}var ad,ac=aO,ab=aN,aa=aL,Z=[],Y="|",X=ac.chunking.enabled&&qq.supportedFeatures.chunking,W=ac.resume.enabled&&X&&qq.supportedFeatures.resume,V=ak(),U=ac.forceMultipart||ac.paramsInBody;return ad={add:function(f){var e,h,g=qq.getUniqueId();if(qq.isFile(f)){e=Z.push({file:f})-1}else{if(!qq.isBlob(f.blob)){throw new Error("Passed obj in not a File or BlobData (in qq.UploadHandlerXhr)")}e=Z.push({blobData:f})-1}return W&&(h=am(e),h&&(g=h.uuid)),Z[e].uuid=g,e},getName:function(f){if(ad.isValid(f)){var e=Z[f].file,h=Z[f].blobData,g=Z[f].newName;return void 0!==g?g:e?null!==e.fileName&&void 0!==e.fileName?e.fileName:e.name:h.name}aa(f+" is not a valid item ID.","error")},setName:function(d,c){Z[d].newName=c},getSize:function(d){var c=Z[d].file||Z[d].blobData.blob;return qq.isFileOrInput(c)?null!=c.fileSize?c.fileSize:c.size:c.size},getFile:function(b){return Z[b]?Z[b].file||Z[b].blobData.blob:void 0},isValid:function(b){return void 0!==Z[b]},reset:function(){Z=[]},expunge:function(b){return ae(b)},getUuid:function(b){return Z[b].uuid},upload:function(e,d){var f=this.getName(e);this.isValid(e)&&(ac.onUpload(e,f),X?ag(e,d):af(e))},cancel:function(d){var c=ac.onCancel(d,this.getName(d));return qq.isPromise(c)?c.then(function(){ae(d)}):c!==!1?(ae(d),!0):!1},getResumableFilesData:function(){var d=[],c=[];return X&&W?(d=void 0===V?qq.getCookieNames(new RegExp("^qqfilechunk\\"+Y+".+\\"+Y+"\\d+\\"+Y+ac.chunking.partSize+"=")):qq.getCookieNames(new RegExp("^qqfilechunk\\"+Y+".+\\"+Y+"\\d+\\"+Y+ac.chunking.partSize+"\\"+Y+V+"=")),qq.each(d,function(b,h){var g=h.split(Y),f=qq.getCookie(h).split(Y);c.push({name:decodeURIComponent(g[1]),size:g[2],uuid:f[0],partIdx:f[1]})}),c):[]}}},qq.UiEventHandler=function(h,g){function l(b){k.attach(b,j.eventType,function(d){d=d||window.event;var c=d.target||d.srcElement;j.onHandled(c,d)})}var k=new qq.DisposeSupport,j={eventType:"click",attachTo:null,onHandled:function(){}},i={addHandler:function(b){l(b)},dispose:function(){k.dispose()}};return qq.extend(g,{getItemFromEventTarget:function(d){for(var c=d.parentNode;void 0===c.qqFileId;){c=c.parentNode}return c},getFileIdFromItem:function(b){return b.qqFileId},getDisposeSupport:function(){return k}}),qq.extend(j,h),j.attachTo&&l(j.attachTo),i},qq.DeleteRetryOrCancelClickHandler=function(g){function f(d,c){if(qq(d).hasClass(h.classes.cancel)||qq(d).hasClass(h.classes.retry)||qq(d).hasClass(h.classes.deleteButton)){var k=i.getItemFromEventTarget(d),e=i.getFileIdFromItem(k);qq.preventDefault(c),h.log(qq.format("Detected valid cancel, retry, or delete click event on file '{}', ID: {}.",h.onGetName(e),e)),j(d,e)}}function j(d,c){qq(d).hasClass(h.classes.deleteButton)?h.onDeleteFile(c):qq(d).hasClass(h.classes.cancel)?h.onCancel(c):h.onRetry(c)}var i={},h={listElement:document,log:function(){},classes:{cancel:"qq-upload-cancel",deleteButton:"qq-upload-delete",retry:"qq-upload-retry"},onDeleteFile:function(){},onCancel:function(){},onRetry:function(){},onGetName:function(){}};qq.extend(h,g),h.eventType="click",h.onHandled=f,h.attachTo=h.listElement,qq.extend(this,new qq.UiEventHandler(h,i))},qq.FilenameEditHandler=function(r,q){function p(e){var d=j.onGetName(e),f=d.lastIndexOf(".");return f>0&&(d=d.substr(0,f)),d}function o(e){var d=j.onGetName(e),f=d.lastIndexOf(".");return f>0?d.substr(f,d.length-f):void 0}function n(f,d){var h,g=f.value;void 0!==g&&qq.trimStr(g).length>0&&(h=o(d),void 0!==h&&(g+=o(d)),j.onSetName(d,g)),j.onEditingStatusChange(d,!1)}function m(b,d){q.getDisposeSupport().attach(b,"blur",function(){n(b,d)})}function l(b,d){q.getDisposeSupport().attach(b,"keyup",function(a){var c=a.keyCode||a.which;13===c&&n(b,d)})}var k,j={listElement:null,log:function(){},classes:{file:"qq-upload-file"},onGetUploadStatus:function(){},onGetName:function(){},onSetName:function(){},onGetInput:function(){},onEditingStatusChange:function(){}};return qq.extend(j,r),j.attachTo=j.listElement,k=qq.extend(this,new qq.UiEventHandler(j,q)),qq.extend(q,{handleFilenameEdit:function(f,c,s,i){var g=j.onGetInput(s);j.onEditingStatusChange(f,!0),g.value=p(f),i&&g.focus(),m(g,f),l(g,f)}}),k},qq.FilenameClickHandler=function(f){function e(d,c){if(qq(d).hasClass(g.classes.file)||qq(d).hasClass(g.classes.editNameIcon)){var k=h.getItemFromEventTarget(d),j=h.getFileIdFromItem(k),i=g.onGetUploadStatus(j);i===qq.status.SUBMITTED&&(g.log(qq.format("Detected valid filename click event on file '{}', ID: {}.",g.onGetName(j),j)),qq.preventDefault(c),h.handleFilenameEdit(j,d,k,!0))}}var h={},g={log:function(){},classes:{file:"qq-upload-file",editNameIcon:"qq-edit-filename-icon"},onGetUploadStatus:function(){},onGetName:function(){}};return qq.extend(g,f),g.eventType="click",g.onHandled=e,qq.extend(this,new qq.FilenameEditHandler(g,h))},qq.FilenameInputFocusInHandler=function(f,e){function h(b){if(qq(b).hasClass(g.classes.editFilenameInput)){var j=e.getItemFromEventTarget(b),i=e.getFileIdFromItem(j),d=g.onGetUploadStatus(i);d===qq.status.SUBMITTED&&(g.log(qq.format("Detected valid filename input focus event on file '{}', ID: {}.",g.onGetName(i),i)),e.handleFilenameEdit(i,b,j))}}var g={listElement:null,classes:{editFilenameInput:"qq-edit-filename"},onGetUploadStatus:function(){},log:function(){}};return e||(e={}),g.eventType="focusin",g.onHandled=h,qq.extend(g,f),qq.extend(this,new qq.FilenameEditHandler(g,e))},qq.FilenameInputFocusHandler=function(b){return b.eventType="focus",b.attachTo=null,qq.extend(this,new qq.FilenameInputFocusInHandler(b,{}))},function(v){var u,t,s,r,q,p,o,n,m,l;p=["uploaderType"],s=function(b){if(b){var c=n(b);o(c),"basic"===q("uploaderType")?u(new qq.FineUploaderBasic(c)):u(new qq.FineUploader(c))}return t},r=function(e,c){var f=t.data("fineuploader");return c?(void 0===f&&(f={}),f[e]=c,t.data("fineuploader",f),void 0):void 0===f?null:f[e]},u=function(b){return r("uploader",b)},q=function(d,c){return r(d,c)},o=function(a){var f=a.callbacks={},c=new qq.FineUploaderBasic;v.each(c._options.callbacks,function(g){var d,h;d=/^on(\w+)/.exec(g)[1],d=d.substring(0,1).toLowerCase()+d.substring(1),h=t,f[g]=function(){var b=Array.prototype.slice.call(arguments);return h.triggerHandler(d,b)}})},n=function(a,g){var f,c;return f=void 0===g?"basic"!==a.uploaderType?{element:t[0]}:{}:g,v.each(a,function(d,e){v.inArray(d,p)>=0?q(d,e):e instanceof v?f[d]=e[0]:v.isPlainObject(e)?(f[d]={},n(e,f[d])):v.isArray(e)?(c=[],v.each(e,function(h,i){i instanceof v?v.merge(c,i):c.push(i)}),f[d]=c):f[d]=e}),void 0===g?f:void 0},m=function(a){return"string"===v.type(a)&&!a.match(/^_/)&&void 0!==u()[a]},l=function(h){var g,b=[],a=Array.prototype.slice.call(arguments,1);return n(a,b),g=u()[h].apply(u(),b),"object"!=typeof g||1!==g.nodeType&&9!==g.nodeType||!g.cloneNode||(g=v(g)),g},v.fn.fineUploader=function(d){var c=this,b=arguments,a=[];return this.each(function(f,e){if(t=v(e),u()&&m(d)){if(a.push(l.apply(c,b)),1===c.length){return !1}}else{"object"!=typeof d&&d?v.error("Method "+d+" does not exist on jQuery.fineUploader"):s.apply(c,b)}}),1===a.length?a[0]:a.length>1?a:this}}(jQuery),function(t){function s(d){d||(d={}),d.dropZoneElements=[l];var c=o(d);return p(c),q(new qq.DragAndDrop(c)),l}function r(e,d){var f=l.data(k);return d?(void 0===f&&(f={}),f[e]=d,l.data(k,f),void 0):void 0===f?null:f[e]}function q(b){return r("dndInstance",b)}function p(a){var d=a.callbacks={};new qq.FineUploaderBasic,t.each(new qq.DragAndDrop.callbacks,function(e){var c,f=e;c=l,d[e]=function(){var b=Array.prototype.slice.call(arguments),g=c.triggerHandler(f,b);return g}})}function o(a,h){var g,f;return g=void 0===h?{}:h,t.each(a,function(d,e){e instanceof t?g[d]=e[0]:t.isPlainObject(e)?(g[d]={},o(e,g[d])):t.isArray(e)?(f=[],t.each(e,function(i,j){j instanceof t?t.merge(f,j):f.push(j)}),g[d]=f):g[d]=e}),void 0===h?g:void 0}function n(a){return"string"===t.type(a)&&"dispose"===a&&void 0!==q()[a]}function m(e){var d=[],f=Array.prototype.slice.call(arguments,1);return o(f,d),q()[e].apply(q(),d)}var l,k="fineUploaderDnd";t.fn.fineUploaderDnd=function(g){var d=this,b=arguments,a=[];return this.each(function(e,c){if(l=t(c),q()&&n(g)){if(a.push(m.apply(d,b)),1===d.length){return !1}}else{"object"!=typeof g&&g?t.error("Method "+g+" does not exist in Fine Uploader's DnD module."):s.apply(d,b)}}),1===a.length?a[0]:a.length>1?a:this}}(jQuery);
/*! 2013-06-28 */
